<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-dialog/paper-dialog.html">

<link rel="import" href="../ct-shared-styles/ct-application-theme.html">
<link rel="import" href="../ct-editable-switcher/ct-editable-switcher.html">

<!--
`ct-view-settings-meter-model`
Element to display global meter model settings on the Centular platform

@demo demo/index.html
-->

<dom-module id="ct-view-settings-meter-model">

  <template>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <style is="custom-styles">
      :host {
        display: block;
        --paper-input-container:{
          border-top: 1px solid #ccc;
          border-left: 1px solid #ccc;
          border-right: 1px solid #ccc;
          border-bottom: none;
          padding: 0 !important;
        };

        --paper-input-container-input: {
          text-overflow: ellipsis;
          width: calc(100% - 20px);
          margin-left: 10px;
        };

        --paper-input-container-label: {
          margin-left: 10px;
        };
      }

      .new-container .row {
        display: flex;
        align-items: center;
      }

      paper-material {
        background: #fff;
        margin-bottom: 15px;
        padding: 10px;
      }

      paper-icon-button + paper-icon-button {
        margin-left: 15px;
      }


    </style>

    <paper-material>
      <div class="fluid-container new-container">
        <div class="row">
          <div class="col-sm-10">
            <paper-input
                    id="newModel"
                    label="New Model Name"
                    required
                    error-message="Please provide a name for the meter model"
                    type="text"></paper-input>
          </div>
          <div class="col-sm-2">
            <paper-button class="btn btn-primary btn-block" on-tap="_newModelHandler" raised>Add Model</paper-button>
          </div>
        </div>
      </div>
    </paper-material>

    <paper-material>

      <div class="fluid-container">

        <div class="row">
          <div class="col-xs-12">
            <div class="table-responsive">
              <table class="table table-striped table-bordered table-hover table-middle">
                <thead>
                <th>Meter Name</th>
                <th class="text-center">Actions</th>
                </thead>
                <tbody>

                <template is="dom-repeat" items="{{meterDataTemp}}">
                  <tr>
                    <td>
                      <ct-editable-switcher id="[[_computeId(index)]]">
                        <paper-input class="input-element" type="text" allowed-pattern="[0-9\.]" no-label="" value="[[item.name]]"></paper-input>
                      </ct-editable-switcher>
                    </td>
                    <td class="text-center">
                      <paper-icon-button icon="create" class="table-button btn-default btn-sm" on-tap="_editHandler" raised></paper-icon-button>
                      <paper-icon-button icon="delete" data-item-id="[[index]]" class="table-button btn-danger btn-sm" on-tap="_modalHandler" raised></paper-icon-button>
                    </td>
                  </tr>
                </template>

                </tbody>
              </table>
            </div>
          </div>
        </div>

      </div>

    </paper-material>

    <paper-dialog
            id="meterModal"
            modal
            no-cancel-on-esc-key
            no-cancel-on-outside-click
            on-iron-overlay-opened="_patchOverlay" >
      <h2>Please Confirm Meter Model Deletion</h2>
      <p>
        Are you sure you want to delete the <strong>Model Name</strong> meter model?
      </p>
      <div class="buttons">
        <paper-button class="btn btn-default" dialog-dismiss>Cancel</paper-button>
        <paper-button class="btn btn-danger" dialog-confirm on-tap="_deleteModel">Delete</paper-button>
      </div>
    </paper-dialog>

  </template>

  <script>
      Polymer({

          is: 'ct-view-settings-meter-model',

          properties: {
              _isStatusEdit : {
                  type: Boolean,
                  value: function() {
                      return false;
                  }
              },

              _deleteId: Number,

              meterDataTemp : {
                  type: Array,
                  value: function(){
                      return [
                          {
                              'id' : 1,
                              'name' : "Meter Number 5"
                          },
                          {
                              'id' : 2,
                              'name' : "Meter Number 6"
                          }
                      ]
                  }
              }
          },

          _computeId : function(idx){
              return 'item-'+idx;
          },

          _computeButtonIcon: function(element){
              if(icon === 'save') {
                  element.setAttribute('icon', 'create');
              } else if(icon === 'create') {
                  element.setAttribute('icon', 'save');
              }
          },

          _computeBtnStyle : function(element){
              if(element.classList.contains('btn-primary')) {
                  element.classList.remove('btn-primary');
                  element.classList.add('btn-default');
              } else if(element.classList.contains('btn-default')){
                  element.classList.remove('btn-default');
                  element.classList.add('btn-primary');
              }
          },

          _toggleStatus : function(element){

              var icon = element.getAttribute('icon');

          },

          _editHandler : function(e){
              var idIdx = '#item-'+e.model.index;
              var inputElem = this.$$(idIdx);

              inputElem.editMode = !inputElem.editMode;

              this._toggleStatus(Polymer.dom(e).localTarget);
          },

          _newModelHandler : function(){

              var newModelInput = this.$.newModel;

              if(newModelInput.validate()){
                  console.log(newModelInput.value);
              }

//          todo: add model api call
//          todo: refresh list of models
//          todo: trigger notification
          },

          _modalHandler : function(e){
              this._deleteId = e.model.item.id;
              this.$.meterModal.open();
          },

          _deleteModel : function(e) {
              console.info('poof! , id: '+this._deleteId+' has been deleted')
          },

          _patchOverlay: function (e) {
              if (e.target.withBackdrop) {
                  e.target.parentNode.insertBefore(e.target.backdropElement, e.target);
              }
          },


      });
  </script>
</dom-module>

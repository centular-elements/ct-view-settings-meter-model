<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-dialog/paper-dialog.html">

<link rel="import" href="../ct-shared-styles/ct-application-theme.html">
<link rel="import" href="../ct-grid-controls/ct-grid-controls.html">
<link rel="import" href="../iron-data-table/iron-data-table.html">

<!--
`ct-view-settings-meter-model`
Element to display global meter model settings on the Centular platform

@demo demo/index.html
-->

<dom-module id="ct-view-settings-meter-model">

  <template>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <style is="custom-styles">
      :host {
        display: block;
      }

      .new-container .row {
        display: flex;
        align-items: center;
      }

      paper-material {
        background: #fff;
        margin-bottom: 15px;
        padding: 10px;
      }


    </style>

    <paper-material>
      <div class="fluid-container new-container">
        <div class="row">
          <div class="col-sm-10">
            <paper-input
                    id="newModel"
                    label="New Model Name"
                    required
                    error-message="Please provide a name for the meter model"
                    type="text"></paper-input>
          </div>
          <div class="col-sm-2">
            <paper-button class="btn btn-primary btn-block" on-tap="_newModelHandler" raised>Add Model</paper-button>
          </div>
        </div>
      </div>
    </paper-material>

    <paper-material>

      <div class="fluid-container">

        <!--<ct-grid-controls items="[[ remoteData ]]" filters="[[filters]]">-->

        <!--include data table-->
        <iron-data-table>

          <data-table-column name="Meter Name">
            <template>[[index]] - [[item.name]]</template>
          </data-table-column>
          <data-table-column name="Unit Number" width="65px" sort-by="unitNumber">
            <template>[[item.unitNumber]]</template>
          </data-table-column>
          <data-table-column name="Address" width="200px" sort-by="buildingAddress">
            <template>[[item.buildingAddress]]</template>
          </data-table-column>
          <data-table-column name="Meter Type" sort-by="meterType.name">
            <template>[[item.meterType.name]]</template>
          </data-table-column>
          <data-table-column name="Meter Number" sort-by="number">
            <template>[[item.number]]</template>
          </data-table-column>
          <data-table-column name="Meter Status" sort-by="meterStatus.name">
            <template>[[item.meterStatus.name]]</template>
          </data-table-column>
          <data-table-column name="Actions">
            <template>
              <button on-tap="_computeAction" data-action="view" class="btn btn-primary">View</button>
            </template>
          </data-table-column>

        </iron-data-table>
        <!--</ct-grid-controls>-->

        <!--<template is="dom-repeat" items="">-->
        <!--<div class="panel panel-default">-->
        <!--<div class="panel-body">-->
        <!--<div class="col-sm-8">-->
        <!--<paper-input-->
        <!--type="text"-->
        <!--no-label-->
        <!--value="Meter Model Name" readonly$="[[_computeReadOnly(_isStatusEdit)]]"></paper-input>-->
        <!--</div>-->
        <!--<div class="col-sm-2">-->
        <!--<paper-icon-button icon="create" class$="btn btn-block [[_computeBtnStyle(_isStatusEdit)]]" on-tap="_editBtnHandler">textHere</paper-icon-button>-->
        <!--</div>-->
        <!--<div class="col-sm-2">-->
        <!--<paper-icon-button class="btn btn-danger btn-block" icon="delete" on-tap="_modalHandler" ></paper-icon-button>-->
        <!--</div>-->
        <!--</div>-->
        <!--</div>-->
        <!--</template>-->


        <!--<div class="panel panel-default">-->
        <!--<div class="panel-body">-->
        <!--<div class="col-sm-8">-->
        <!--<paper-input-->
        <!--type="text"-->
        <!--no-label-->
        <!--value="Meter Model Name" readonly$="[[_computeReadOnly(_isStatusEdit)]]"></paper-input>-->
        <!--</div>-->
        <!--<div class="col-sm-2">-->
        <!--<paper-icon-button icon="create" class$="btn btn-block [[_computeBtnStyle(_isStatusEdit)]]" on-tap="_editBtnHandler">textHere</paper-icon-button>-->
        <!--</div>-->
        <!--<div class="col-sm-2">-->
        <!--<paper-icon-button class="btn btn-danger btn-block" icon="delete" on-tap="_modalHandler" ></paper-icon-button>-->
        <!--</div>-->
        <!--</div>-->
        <!--</div>-->

      </div>

    </paper-material>

    <paper-dialog
            id="meterModal"
            modal
            no-cancel-on-esc-key
            no-cancel-on-outside-click
            on-iron-overlay-opened="_patchOverlay" >
      <h2>Please Confirm Meter Model Deletion</h2>
      <p>
        Are you sure you want to delete the <strong>Model Name</strong> meter model?
      </p>
      <div class="buttons">
        <paper-button class="btn btn-default"dialog-dismiss>Cancel</paper-button>
        <paper-button class="btn btn-danger"dialog-confirm on-tap="_removeModelHandler">Delete</paper-button>
      </div>
    </paper-dialog>

  </template>

  <script>
      Polymer({

          is: 'ct-view-settings-meter-model',

          properties: {
              _isStatusEdit : {
                  type: Boolean,
                  value: function() {
                      return false;
                  }
              },
          },

          _computeReadOnly : function(status){
              return (!status);
          },

          _computeButtonText: function(isEdit){
              return (isEdit) ? 'Save Model' : 'Edit Model';
          },

          _computeBtnStyle : function(isEdit){
              return (isEdit) ? "btn-primary" : "btn-default";
          },

          _toggleStatus : function(){
              this._isStatusEdit = !this._isStatusEdit;
          },

          _editBtnHandler : function(){
//            todo: event fired on edit/save
//            todo: event to emit notification

              this._toggleStatus();
          },

          _newModelHandler : function(){

              var newModelInput = this.$.newModel;

              if(newModelInput.validate()){
                  console.log(newModelInput.value);
              }

//          todo: add model api call
//          todo: refresh list of models
//          todo: trigger notification
          },

          _modalHandler : function(e){
              this.$.meterModal.open();
          },

          _renameModelHandler : function(e) {
              var modelObj = e.model.item;

              //          todo: rename model api call
//          todo: refresh list of models
//          todo: trigger notification
          },

          _removeModelHandler : function(e) {
              var modelObj = e.model.item;

              //          todo: remove model api call
//          todo: refresh list of models
//          todo: trigger notification
          },

          _patchOverlay: function (e) {
              if (e.target.withBackdrop) {
                  e.target.parentNode.insertBefore(e.target.backdropElement, e.target);
              }
          },

      });
  </script>
</dom-module>
